#
# vim:ft=zsh:
#

function nixos-active-default-boot() {
  local defaultEntry="$( awk '/^default / {print $2}' /boot/loader/loader.conf | tr -d '\n' )"
  debug "defaultEntry=${defaultEntry}"
  local entryPath="/boot/loader/entries/${defaultEntry}.conf"

  if [[ ! -f "${entryPath}" ]]; then
    >&2 echo "ERR: the defaultEntry was not found at ${entryPath}"
    return 1
  fi

  local systemConfig="$( awk '/^options / {print $2}' "${entryPath}" | cut -d'=' -f2 )"
  debug "systemConfig=${systemConfig}"

  >&2 echo "activating the default boot system located at ${systemConfig}"
  sudo -i "${systemConfig}/activate"
}
