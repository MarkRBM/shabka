#!/bin/bash

prog=$(basename $0)

function help {
        rc=$1
        echo "$prog [-r REVISION] FILE..."
        exit $rc
}

if [ -z "$1" ] ; then
        help 1
fi

#defaults
REVISION="HEAD"

while ! [ -z "$1" ] ; do
        word="$1"
        shift
        case $word in
           -r)
                REVISION=$1
                shift
                if [ -z "$REVISION" ] ; then
                        help 1
                fi
                ;;
            *)
                git-ls-tree "$REVISION" "$word" |
                while read -r mode type sha name
                do
                        case "$type" in
                            blob)
                                git-cat-file blob "$sha"
                                ;;
                            tree)
                                git-ls-tree "$sha"
                                ;;
                            *)
                                exit 1
                                ;;
                        esac
                done
                ;;
        esac
done
