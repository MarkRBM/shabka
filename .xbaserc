#!/bin/bash
set -e

# simplified pathmunge used for early X
function _pathmunge() {
  [[ ! -d "${1}" ]] && return
  if ! [[ $PATH =~ (^|:)$1($|:) ]]; then
    PATH=$1:$PATH
  fi
}

if [[ -z "${XBASERC}" ]]; then
  export XBASERC="true"

  # add my bin folders to the PATH
  _pathmunge "${HOME}/.bin"
  _pathmunge "${HOME}/code/bin"
  _pathmunge "${HOME}/.filesystem/bin"

  userresources="$HOME/.Xresources"
  usermodmap="$HOME/.Xmodmap"
  sysresources="/etc/X11/xinit/.Xresources"
  sysmodmap="/etc/X11/xinit/.Xmodmap"

  # merge in defaults and keymaps
  [[ -f "${sysresources}" ]] && xrdb -merge "${sysresources}"
  [[ -f "${sysmodmap}" ]] && xmodmap "${sysmodmap}"
  [[ -f "${userresources}" ]] && xrdb -merge "${userresources}"
  [[ -f "${usermodmap}" ]] && xmodmap "${usermodmap}"

  # Use termite as the terminal
  export TERMINAL=termite

  # change the resolution
  if xrandr | grep -q '^DP1 connected'; then
    xrandr --output eDP1 --mode 1920x1080 --output DP1 --auto --right-of eDP1
  else
    xrandr --output eDP1 --mode 1920x1080
  fi

  # set the keyboard delay to 200ms and the repeat rate to 30Hz
  xset r rate 200 30

  # set beep to off
  xset b off
fi

unfunction _pathmunge
