#!/bin/bash
set -e

# simplified pathmunge used for early X
function _pathmunge() {
  [[ ! -d "${1}" ]] && return
  if ! [[ $PATH =~ (^|:)$1($|:) ]]; then
    PATH=$1:$PATH
  fi
}

# prevent this from running twice
if [[ -z "${XBASERC}" ]]; then
  export XBASERC="true"

  # Important variable
  export BROWSER="${HOME}/.bin/relay-browser"
  export EDITOR="nvim"
  export LANG=en_US.UTF-8
  export LC_ALL="${LANG}"
  export MYFS="${HOME}/.filesystem"
  export SUDO_EDITOR="nvim"
  export TERMINAL=termite

  # add my bin folders to the PATH
  _pathmunge "${HOME}/.bin"
  _pathmunge "${HOME}/code/bin"
  _pathmunge "${HOME}/.filesystem/bin"

  # merge in defaults and keymaps
  userresources="$HOME/.Xresources"
  usermodmap="$HOME/.Xmodmap"
  sysresources="/etc/X11/xinit/.Xresources"
  sysmodmap="/etc/X11/xinit/.Xmodmap"
  [[ -f "${sysresources}" ]] && xrdb -merge "${sysresources}"
  [[ -f "${sysmodmap}" ]] && xmodmap "${sysmodmap}"
  [[ -f "${userresources}" ]] && xrdb -merge "${userresources}"
  [[ -f "${usermodmap}" ]] && xmodmap "${usermodmap}"


  # change the resolution
  if xrandr | grep -q '^DP1 connected'; then
    xrandr --output eDP1 --mode 1920x1080 --output DP1 --auto --right-of eDP1
  else
    xrandr --output eDP1 --mode 1920x1080
  fi

  # set beep to off
  xset b off
fi

unset -f _pathmunge
